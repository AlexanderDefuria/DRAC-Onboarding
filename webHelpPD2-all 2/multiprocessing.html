<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-01-14T21:03:20.995437"><title>Multiprocessing | Python DRAC</title><script type="application/json" id="virtual-toc-data">[{"id":"example","level":0,"title":"Example","anchor":"#example"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Multiprocessing | Python DRAC"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Python DRAC Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/multiprocessing.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Multiprocessing | Python DRAC"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/multiprocessing.html#webpage",
    "url": "writerside-documentation/multiprocessing.html",
    "name": "Multiprocessing | Python DRAC",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Python DRAC Help"
}</script><!-- End Schema.org --></head><body data-id="Multiprocessing" data-main-title="Multiprocessing" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Python DRAC  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Multiprocessing" id="Multiprocessing.md">Multiprocessing</h1><p id="ipo565_3">Multiprocessing can be a massive improvement in computational efficiency. In many cases it is crucial to parallelize operations to complete tasks in a reasonable amount of time. It is also one of the main draws of the alliance HPC given the large number of high core-count CPU's available. Multiprocessing has many unique across different applications. In this guide we aim to provide an overview of both basic multiprocessing and distributed computing.</p><aside class="prompt" data-type="tip" data-title="" id="ipo565_4"><p>This is an introduction, more advanced documentation can be found <a href="https://google.ca" id="ipo565_9" data-external="true" rel="noopener noreferrer">here</a>.</p></aside><p id="ipo565_5">Python in particular has many nuances in parallel programming due to the Global Interpreter Lock (GIL). By using a multiprocessing library like the <a href="https://docs.python.org/3/library/multiprocessing.html" id="ipo565_10" data-external="true" rel="noopener noreferrer">built-in library</a> or <a href="https://pathos.readthedocs.io/en/latest/" id="ipo565_11" data-external="true" rel="noopener noreferrer">pathos library</a> one can effectively &quot;side step the GIL&quot; allowing for full performance parallelization <span class="control" id="ipo565_12">When Implemented Correctly</span>. More information can be found in <a href="https://medium.com/@kyeg/unleashing-pythons-potential-how-pathos-and-multi-processing-overcome-the-gil-lock-and-other-2e2d590b8dfd" id="ipo565_13" data-external="true" rel="noopener noreferrer">this medium article</a></p><aside class="prompt" data-type="warning" data-title="" id="ipo565_6"><p>Many application libraries perform parallelization on their own, this often may conflict with user implemented parallelization. This occurs with libraries like <code class="code" id="ipo565_14">XGBoost</code> and <code class="code" id="ipo565_15">Sci-kit Opt</code></p></aside><p id="ipo565_7">Conflicting parallelization libraries may cause locking or other erroneous behaviour. It is good practice to disable the backend parallelization if issues arise but not before this is confirmed to be problematic, simply be aware it may arise. If issues do arise many programs have options within the python source code to disable this behaviour like <code class="code" id="ipo565_16">Sci-kit Opt</code>. Other libraries like <code class="code" id="ipo565_17">XGBoost</code> require environment variable manipulation. If you are trying to perform multiprocessing and issues are arising, check to see if any libraries are conflicting with your design.</p><section class="chapter"><h2 id="example" data-toc="example">Example</h2><div class="code-block" data-lang="python">
import multiprocessing
import csv
import os

def worker(task_id):
    #Simulate some dummy computation
    result = {'TaskID': task_id, 'Result': task_id * 2}
    return result

def collect_results():
    num_cpu = int(os.getenv('SLURM_CPUS_PER_TASK', 10))  # Number of tasks to simulate
    num_task = 100
    with multiprocessing.Pool(processes=num_cpu) as pool:
    results = pool.map(worker, range(num_tasks))
    return results

#Collect results from multiprocessing tasks
results = collect_results()

#Save results to a CSV file
output_file = 'dummy_results.csv'
with open(output_file, mode='w', newline='') as file:
    writer = csv.DictWriter(file, fieldnames=['TaskID', 'Result'])
    writer.writeheader()
    writer.writerows(results)

#Check if the file was created
print(os.path.exists(output_file))

</div><div class="code-block" data-lang="python">
from pathos.pools import ProcessPool
import time

def slow_function(x):
    time.sleep(1)  # Simulate a time-consuming operation
    return x * x

if __name__ == '__main__':
    num_cpu = int(os.getenv('SLURM_CPUS_PER_TASK', 10))  # Number of tasks to simulate
    pool = ProcessPool(nodes=num_cpu)  # Create a pool with 4 worker processes

    # Start an asynchronous map
    tasks = range(
    async_result = pool.amap(slow_function, range(100))
    
    print(&quot;Tasks submitted, now we can do other work...&quot;)
    
    # Check if the result is ready
    while not async_result.ready():
        print(&quot;Waiting for results...&quot;)
        time.sleep(0.5)
    
    # Get the results
    results = async_result.get()
    print(&quot;Results:&quot;, results)


</div></section><div class="last-modified">Last modified: 15 January 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="copying-files.html" class="navigation-links__prev">Copying Files</a><a href="gpu-jobs.html" class="navigation-links__next">GPU Jobs</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.js"></script></body></html>